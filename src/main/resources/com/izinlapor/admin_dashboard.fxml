<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.ComboBox?>
<?import javafx.scene.control.DatePicker?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.ListView?>
<?import javafx.scene.control.ScrollPane?>
<?import javafx.scene.control.Separator?>
<?import javafx.scene.control.Tab?>
<?import javafx.scene.control.TabPane?>
<?import javafx.scene.control.TableColumn?>
<?import javafx.scene.control.TableView?>
<?import javafx.scene.control.TextArea?>
<?import javafx.scene.control.TextField?>
<?import javafx.scene.chart.BarChart?>
<?import javafx.scene.chart.CategoryAxis?>
<?import javafx.scene.chart.NumberAxis?>
<?import javafx.scene.image.ImageView?>
<?import javafx.scene.layout.BorderPane?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.VBox?>
<?import javafx.scene.text.Font?>

<BorderPane prefHeight="700.0" prefWidth="1000.0" styleClass="root" xmlns="http://javafx.com/javafx/13" xmlns:fx="http://javafx.com/fxml/1" fx:controller="com.izinlapor.controller.AdminDashboardController">
    
    <!-- Sidebar -->
    <left>
        <VBox prefWidth="250.0" spacing="10.0" style="-fx-background-color: #f0f0f0;" BorderPane.alignment="CENTER">
            <padding>
                <Insets bottom="20.0" left="20.0" right="20.0" top="20.0" />
            </padding>
            
            <!-- Profile Area -->
            <VBox alignment="CENTER" spacing="5.0">
                <ImageView fx:id="sidebarProfileImageView" fitHeight="80.0" fitWidth="80.0" pickOnBounds="true" preserveRatio="true" />
                <Label fx:id="sidebarNameLabel" text="Admin" wrapText="true" textAlignment="CENTER">
                    <font>
                        <Font name="System Bold" size="14.0" />
                    </font>
                </Label>
            </VBox>
            
            <Separator />
            
            <Label text="Menu">
                <font>
                    <Font name="System Bold" size="14.0" />
                </font>
                <padding>
                    <Insets left="0.0" />
                </padding>
            </Label>
            
            <!-- Navigation -->
            <VBox spacing="5.0">
                <Button maxWidth="Infinity" onAction="#handleGoToDashboard" text="Dashboard" />
                <Button maxWidth="Infinity" onAction="#handleGoToManageReports" text="Kelola Pengaduan" />
                <Button maxWidth="Infinity" onAction="#handleGoToManageUsers" text="Kelola User" />
            </VBox>
            
            <VBox alignment="BOTTOM_LEFT" VBox.vgrow="ALWAYS" spacing="5.0">
                <Button maxWidth="Infinity" onAction="#handleResetDatabase" text="Reset Database" style="-fx-background-color: #ffebee; -fx-text-fill: #c62828; -fx-font-weight: bold;" />
                <Button maxWidth="Infinity" onAction="#handleLogout" text="Keluar" />
            </VBox>
        </VBox>
    </left>

    <!-- Main Content -->
    <center>
        <TabPane fx:id="mainTabPane" styleClass="tab-pane" tabClosingPolicy="UNAVAILABLE" BorderPane.alignment="CENTER">
            <tabs>
                <!-- Dashboard Tab -->
                <Tab fx:id="dashboardTab" text="Dashboard">
                    <content>
                        <ScrollPane fitToWidth="true" style="-fx-background-color: transparent; -fx-background: transparent;">
                            <content>
                                <VBox spacing="30.0">
                                    <padding>
                                        <Insets bottom="40.0" left="40.0" right="40.0" top="40.0" />
                                    </padding>

                                    <VBox spacing="5.0">
                                        <Label styleClass="section-header" text="Dashboard Overview" />
                                        <Label styleClass="subheading-label" text="Ringkasan aktivitas pengaduan terkini." />
                                    </VBox>

                                    <HBox spacing="20.0">
                                        <!-- Total Reports Card -->
                                        <VBox styleClass="card" HBox.hgrow="ALWAYS">
                                            <Label styleClass="card-header" text="Total Laporan" />
                                            <Label fx:id="totalReportsLabel" styleClass="card-value, card-value-primary" text="0" />
                                            <Label styleClass="card-subtext" text="Semua waktu" />
                                        </VBox>

                                        <!-- Processing Card -->
                                        <VBox styleClass="card" HBox.hgrow="ALWAYS">
                                            <Label styleClass="card-header" text="Sedang Diproses" />
                                            <Label fx:id="processingReportsLabel" styleClass="card-value, card-value-warning" text="0" />
                                            <Label styleClass="card-subtext" text="Perlu tindakan" />
                                        </VBox>

                                        <!-- Finished Card -->
                                        <VBox styleClass="card" HBox.hgrow="ALWAYS">
                                            <Label styleClass="card-header" text="Selesai" />
                                            <Label fx:id="finishedReportsLabel" styleClass="card-value, card-value-success" text="0" />
                                            <Label styleClass="card-subtext" text="Terselesaikan" />
                                        </VBox>
                                    </HBox>
                                    
                                    <!-- Recent Activity Section (Reverted) -->
                                    <VBox styleClass="card" VBox.vgrow="ALWAYS">
                                        <Label style="-fx-font-size: 18px; -fx-font-weight: bold;" text="Aktivitas Terbaru" textFill="#333333" />
                                        <Separator style="-fx-padding: 15 0 15 0;" />
                                        <Label text="Fitur log aktivitas akan segera hadir." textFill="#666666" />
                                    </VBox>
                                </VBox>
                            </content>
                        </ScrollPane>
                    </content>
                </Tab>

                <!-- Manage Reports Tab -->
                <Tab fx:id="manageReportsTab" text="Kelola Pengaduan">
                    <content>
                        <VBox spacing="20.0">
                            <padding>
                                <Insets bottom="30.0" left="30.0" right="30.0" top="30.0" />
                            </padding>
                            
                            <VBox spacing="5.0">
                                <Label styleClass="section-header" text="Daftar Pengaduan" />
                                <Label styleClass="subheading-label" text="Kelola dan update status laporan masuk." />
                            </VBox>

                            <!-- Search & Filter Bar -->
                            <HBox spacing="15.0" alignment="CENTER_LEFT">
                                <TextField fx:id="searchField" promptText="Cari Judul / User ID..." prefWidth="300.0" styleClass="text-field"/>
                                <ComboBox fx:id="filterStatusComboBox" promptText="Filter Status" prefWidth="180.0" styleClass="combo-box"/>
                                <DatePicker fx:id="startDatePicker" promptText="Dari Tanggal" prefWidth="150.0" />
                                <DatePicker fx:id="endDatePicker" promptText="Sampai Tanggal" prefWidth="150.0" />
                                <Button onAction="#handleExportReports" text="Export ke CSV" style="-fx-background-color: #2e7d32; -fx-text-fill: white; -fx-font-weight: bold;"/>
                            </HBox>

                            <!-- Table -->
                            <TableView fx:id="reportsTable" styleClass="table-view" VBox.vgrow="ALWAYS">
                                <columns>
                                    <TableColumn fx:id="colDate" prefWidth="150.0" text="Tanggal" />
                                    <TableColumn fx:id="colUser" prefWidth="120.0" text="User ID" />
                                    <TableColumn fx:id="colTitle" prefWidth="250.0" text="Judul" />
                                    <TableColumn fx:id="colCategory" prefWidth="150.0" text="Kategori" />
                                    <TableColumn fx:id="colStatus" prefWidth="120.0" text="Status" />
                                </columns>
                                <columnResizePolicy>
                                    <TableView fx:constant="CONSTRAINED_RESIZE_POLICY" />
                                </columnResizePolicy>
                            </TableView>

                            <!-- Action Area -->
                            <VBox styleClass="card" spacing="15.0">
                                <Label style="-fx-font-weight: bold; -fx-font-size: 14px;" text="Detail &amp; Tindakan" />
                                <HBox spacing="20.0">
                                    <VBox spacing="5.0">
                                        <Label text="Bukti Foto:" textFill="#65676b"/>
                                        <ImageView fx:id="evidenceImageView" fitHeight="150.0" fitWidth="200.0" pickOnBounds="true" preserveRatio="true" style="-fx-effect: dropshadow(three-pass-box, rgba(0,0,0,0.2), 5, 0, 0, 1);" />
                                    </VBox>
                                    
                                    <Separator orientation="VERTICAL" />
                                    
                                    <VBox spacing="15.0" HBox.hgrow="ALWAYS">
                                        <Label text="Tanggapan Admin:" textFill="#65676b"/>
                                        <TextArea fx:id="responseArea" promptText="Tulis tanggapan untuk pelapor..." prefHeight="80.0" wrapText="true" />
                                        
                                        <Label text="Update Status Laporan:" textFill="#65676b"/>
                                        <HBox spacing="10.0" alignment="CENTER_LEFT">
                                            <ComboBox fx:id="statusComboBox" promptText="Pilih Status Baru" prefWidth="200.0" styleClass="combo-box"/>
                                            <Button onAction="#handleUpdateStatus" styleClass="button-primary" text="Simpan Perubahan" />
                                        </HBox>
                                    </VBox>
                                </HBox>
                            </VBox>
                            
                            <!-- Chat Area -->
                            <VBox styleClass="card" spacing="10.0" VBox.vgrow="ALWAYS">
                                <Label style="-fx-font-weight: bold; -fx-font-size: 14px;" text="Diskusi / Chat" />
                                <ListView fx:id="chatListView" VBox.vgrow="ALWAYS" prefHeight="150.0"/>
                                <HBox spacing="10.0">
                                    <TextField fx:id="chatInputField" promptText="Tulis pesan..." HBox.hgrow="ALWAYS"/>
                                    <Button text="Kirim" onAction="#handleSendChat"/>
                                </HBox>
                            </VBox>
                        </VBox>
                    </content>
                </Tab>

                <!-- Manage Users Tab -->
                <Tab fx:id="manageUsersTab" text="Kelola User">
                    <content>
                        <VBox spacing="20.0">
                            <padding>
                                <Insets bottom="30.0" left="30.0" right="30.0" top="30.0" />
                            </padding>
                            
                            <VBox spacing="5.0">
                                <Label styleClass="section-header" text="Daftar Pengguna" />
                                <Label styleClass="subheading-label" text="Lihat detail dan kelola pengguna terdaftar." />
                            </VBox>

                            <!-- Search Bar -->
                            <HBox spacing="15.0" alignment="CENTER_LEFT">
                                <TextField fx:id="userSearchField" promptText="Cari Nama / Username / NIK..." prefWidth="300.0" styleClass="text-field"/>
                            </HBox>

                            <!-- Table -->
                            <TableView fx:id="usersTable" styleClass="table-view" VBox.vgrow="ALWAYS">
                                <columns>
                                    <TableColumn fx:id="colUserNik" prefWidth="150.0" text="NIK" />
                                    <TableColumn fx:id="colUserName" prefWidth="200.0" text="Nama Lengkap" />
                                    <TableColumn fx:id="colUserUsername" prefWidth="150.0" text="Username" />
                                    <TableColumn fx:id="colUserEmail" prefWidth="200.0" text="Email" />
                                    <TableColumn fx:id="colUserRole" prefWidth="100.0" text="Role" />
                                </columns>
                                <columnResizePolicy>
                                    <TableView fx:constant="CONSTRAINED_RESIZE_POLICY" />
                                </columnResizePolicy>
                            </TableView>

                            <!-- User Detail Area -->
                            <VBox styleClass="card" spacing="15.0">
                                <Label style="-fx-font-weight: bold; -fx-font-size: 14px;" text="Detail Pengguna" />
                                <HBox spacing="30.0">
                                    <!-- Profile Photo -->
                                    <VBox spacing="5.0" alignment="TOP_CENTER">
                                        <ImageView fx:id="userProfileImageView" fitHeight="120.0" fitWidth="120.0" pickOnBounds="true" preserveRatio="true" style="-fx-effect: dropshadow(three-pass-box, rgba(0,0,0,0.2), 5, 0, 0, 1);" />
                                    </VBox>
                                    
                                    <Separator orientation="VERTICAL" />
                                    
                                    <!-- Info -->
                                    <VBox spacing="10.0" HBox.hgrow="ALWAYS">
                                        <HBox spacing="10.0">
                                            <Label text="NIK:" style="-fx-font-weight: bold; -fx-min-width: 100;" />
                                            <Label fx:id="detailNikLabel" text="-" />
                                        </HBox>
                                        <HBox spacing="10.0">
                                            <Label text="Nama:" style="-fx-font-weight: bold; -fx-min-width: 100;" />
                                            <Label fx:id="detailNameLabel" text="-" />
                                        </HBox>
                                        <HBox spacing="10.0">
                                            <Label text="Username:" style="-fx-font-weight: bold; -fx-min-width: 100;" />
                                            <Label fx:id="detailUsernameLabel" text="-" />
                                        </HBox>
                                        <HBox spacing="10.0">
                                            <Label text="Email:" style="-fx-font-weight: bold; -fx-min-width: 100;" />
                                            <Label fx:id="detailEmailLabel" text="-" />
                                        </HBox>
                                        <HBox spacing="10.0">
                                            <Label text="No. HP:" style="-fx-font-weight: bold; -fx-min-width: 100;" />
                                            <Label fx:id="detailPhoneLabel" text="-" />
                                        </HBox>
                                        <HBox spacing="10.0">
                                            <Label text="Alamat:" style="-fx-font-weight: bold; -fx-min-width: 100;" />
                                            <Label fx:id="detailAddressLabel" text="-" wrapText="true" />
                                        </HBox>
                                    </VBox>

                                    <Separator orientation="VERTICAL" />

                                    <!-- Actions -->
                                    <VBox alignment="CENTER_RIGHT" spacing="10.0">
                                        <Button onAction="#handleDeleteUser" style="-fx-background-color: #ffebee; -fx-text-fill: #c62828; -fx-font-weight: bold;" text="Hapus User" />
                                    </VBox>
                                </HBox>
                            </VBox>
                        </VBox>
                    </content>
                </Tab>
            </tabs>
        </TabPane>
    </center>
</BorderPane>
