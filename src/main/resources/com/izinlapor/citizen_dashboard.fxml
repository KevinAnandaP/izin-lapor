<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.ComboBox?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.ListView?>
<?import javafx.scene.control.ScrollPane?>
<?import javafx.scene.control.Separator?>
<?import javafx.scene.control.PasswordField?>
<?import javafx.scene.control.Tab?>
<?import javafx.scene.control.TabPane?>
<?import javafx.scene.control.TableColumn?>
<?import javafx.scene.control.TableView?>
<?import javafx.scene.control.TextArea?>
<?import javafx.scene.control.TextField?>
<?import javafx.scene.image.ImageView?>
<?import javafx.scene.layout.BorderPane?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.Region?>
<?import javafx.scene.layout.VBox?>
<?import javafx.scene.text.Font?>

<BorderPane prefHeight="600.0" prefWidth="800.0" xmlns="http://javafx.com/javafx/13" xmlns:fx="http://javafx.com/fxml/1" fx:controller="com.izinlapor.controller.CitizenDashboardController">
    <left>
        <VBox spacing="10.0" style="-fx-background-color: #f0f0f0;" BorderPane.alignment="CENTER">
            <padding>
                <Insets bottom="20.0" left="20.0" right="20.0" top="20.0" />
            </padding>
            
            <VBox alignment="CENTER" spacing="5.0">
                <ImageView fx:id="sidebarProfileImageView" fitHeight="80.0" fitWidth="80.0" pickOnBounds="true" preserveRatio="true" />
                <Label fx:id="sidebarNameLabel" text="User" wrapText="true" textAlignment="CENTER">
                    <font>
                        <Font name="System Bold" size="14.0" />
                    </font>
                </Label>
            </VBox>
            <Separator />
            
            <Label text="Menu">
                <font>
                    <Font name="System Bold" size="14.0" />
                </font>
            </Label>
            
            <VBox spacing="5.0">
                <Button maxWidth="Infinity" onAction="#handleGoToHome" text="Beranda" />
                <Button maxWidth="Infinity" onAction="#handleGoToCreateReport" text="Buat Pengaduan" />
                <Button maxWidth="Infinity" onAction="#handleGoToHistory" text="Riwayat Laporan" />
                <Button maxWidth="Infinity" onAction="#handleGoToProfile" text="Edit Profil" />
            </VBox>
            
            <VBox alignment="BOTTOM_LEFT" VBox.vgrow="ALWAYS">
                <Button maxWidth="Infinity" onAction="#handleLogout" text="Keluar" />
            </VBox>
        </VBox>
    </left>
    <center>
        <TabPane fx:id="mainTabPane" tabClosingPolicy="UNAVAILABLE" style="-fx-tab-min-height: 0; -fx-tab-max-height: 0; -fx-padding: 0;" BorderPane.alignment="CENTER">
            <tabs>
                <Tab fx:id="homeTab" text="Beranda">
                    <content>
                        <ScrollPane fitToWidth="true" style="-fx-background-color: transparent;">
                            <content>
                                <VBox spacing="30.0" style="-fx-background-color: #f4f4f4;">
                                    <padding>
                                        <Insets bottom="30.0" left="30.0" right="30.0" top="30.0" />
                                    </padding>
                                    
                                    <!-- Welcome Section -->
                                    <VBox spacing="10.0">
                                        <Label fx:id="welcomeLabel" text="Selamat Datang, Warga!" textFill="#333333">
                                            <font>
                                                <Font name="System Bold" size="28.0" />
                                            </font>
                                        </Label>
                                        <Label text="Mari bersama membangun lingkungan yang lebih baik." textFill="#666666">
                                            <font>
                                                <Font size="16.0" />
                                            </font>
                                        </Label>
                                    </VBox>

                                    <!-- Quick Actions -->
                                    <HBox spacing="20.0">
                                        <Button onAction="#handleGoToCreateReport" prefHeight="100.0" prefWidth="200.0" style="-fx-background-color: #4CAF50; -fx-text-fill: white; -fx-font-size: 16px; -fx-font-weight: bold; -fx-background-radius: 8; -fx-cursor: hand;" text="Buat Laporan Baru" />
                                        <Button onAction="#handleGoToHistory" prefHeight="100.0" prefWidth="200.0" style="-fx-background-color: #2196F3; -fx-text-fill: white; -fx-font-size: 16px; -fx-font-weight: bold; -fx-background-radius: 8; -fx-cursor: hand;" text="Cek Riwayat" />
                                    </HBox>

                                    <!-- Recent Status Card -->
                                    <VBox style="-fx-background-color: white; -fx-padding: 20; -fx-background-radius: 10; -fx-effect: dropshadow(three-pass-box, rgba(0,0,0,0.1), 5, 0, 0, 2);">
                                        <Label text="Status Terkini" textFill="#333333">
                                            <font>
                                                <Font name="System Bold" size="18.0" />
                                            </font>
                                        </Label>
                                        <Separator style="-fx-padding: 10 0 10 0;" />
                                        <Label fx:id="recentStatusLabel" text="Belum ada aktivitas terbaru." textFill="#555555" wrapText="true">
                                            <font>
                                                <Font size="14.0" />
                                            </font>
                                        </Label>
                                    </VBox>

                                    <!-- Guide Section -->
                                    <VBox spacing="15.0" style="-fx-background-color: white; -fx-padding: 20; -fx-background-radius: 10; -fx-effect: dropshadow(three-pass-box, rgba(0,0,0,0.1), 5, 0, 0, 2);">
                                        <Label text="Cara Melapor" textFill="#333333">
                                            <font>
                                                <Font name="System Bold" size="18.0" />
                                            </font>
                                        </Label>
                                        <HBox spacing="20.0" alignment="CENTER_LEFT">
                                            <VBox alignment="CENTER" spacing="5.0" HBox.hgrow="ALWAYS">
                                                <Label text="1" style="-fx-background-color: #e0e0e0; -fx-background-radius: 20; -fx-min-width: 40; -fx-min-height: 40; -fx-alignment: center; -fx-font-weight: bold;" />
                                                <Label text="Ambil Foto" />
                                            </VBox>
                                            <Label text="→" textFill="#999999" />
                                            <VBox alignment="CENTER" spacing="5.0" HBox.hgrow="ALWAYS">
                                                <Label text="2" style="-fx-background-color: #e0e0e0; -fx-background-radius: 20; -fx-min-width: 40; -fx-min-height: 40; -fx-alignment: center; -fx-font-weight: bold;" />
                                                <Label text="Isi Detail" />
                                            </VBox>
                                            <Label text="→" textFill="#999999" />
                                            <VBox alignment="CENTER" spacing="5.0" HBox.hgrow="ALWAYS">
                                                <Label text="3" style="-fx-background-color: #e0e0e0; -fx-background-radius: 20; -fx-min-width: 40; -fx-min-height: 40; -fx-alignment: center; -fx-font-weight: bold;" />
                                                <Label text="Kirim" />
                                            </VBox>
                                            <Label text="→" textFill="#999999" />
                                            <VBox alignment="CENTER" spacing="5.0" HBox.hgrow="ALWAYS">
                                                <Label text="4" style="-fx-background-color: #e0e0e0; -fx-background-radius: 20; -fx-min-width: 40; -fx-min-height: 40; -fx-alignment: center; -fx-font-weight: bold;" />
                                                <Label text="Pantau" />
                                            </VBox>
                                        </HBox>
                                    </VBox>
                                </VBox>
                            </content>
                        </ScrollPane>
                    </content>
                </Tab>
                <Tab fx:id="createReportTab" text="Buat Pengaduan">
                    <content>
                        <VBox spacing="10.0">
                            <padding>
                                <Insets bottom="20.0" left="20.0" right="20.0" top="20.0" />
                            </padding>
                            <Label text="Formulir Pengaduan">
                                <font>
                                    <Font size="16.0" />
                                </font>
                            </Label>
                            <TextField fx:id="titleField" promptText="Judul Laporan" />
                            <ComboBox fx:id="categoryComboBox" promptText="Pilih Kategori" maxWidth="Infinity" />
                            <TextArea fx:id="contentField" prefHeight="100.0" promptText="Isi Laporan / Kronologi" />
                            <Button onAction="#handleChoosePhoto" text="Pilih Foto Bukti" />
                            <Label fx:id="photoPathLabel" text="Tidak ada file dipilih" />
                            <ImageView fx:id="previewImageView" fitHeight="150.0" fitWidth="200.0" pickOnBounds="true" preserveRatio="true" />
                            <Button onAction="#handleSubmitReport" text="Kirim Laporan" />
                        </VBox>
                    </content>
                </Tab>
                <Tab fx:id="historyTab" text="Riwayat Laporan">
                    <content>
                        <VBox spacing="10.0">
                            <padding>
                                <Insets bottom="20.0" left="20.0" right="20.0" top="20.0" />
                            </padding>
                            <HBox spacing="10.0" alignment="CENTER_LEFT">
                                <TextField fx:id="searchField" promptText="Cari Judul..." HBox.hgrow="ALWAYS"/>
                                <ComboBox fx:id="filterStatusComboBox" promptText="Filter Status" prefWidth="150.0"/>
                            </HBox>
                            <TableView fx:id="historyTable" VBox.vgrow="ALWAYS">
                                <columns>
                                    <TableColumn fx:id="colDate" prefWidth="150.0" text="Tanggal" />
                                    <TableColumn fx:id="colTitle" prefWidth="200.0" text="Judul" />
                                    <TableColumn fx:id="colCategory" prefWidth="150.0" text="Kategori" />
                                    <TableColumn fx:id="colStatus" prefWidth="100.0" text="Status" />
                                </columns>
                            </TableView>
                            <HBox spacing="10.0" alignment="CENTER_LEFT">
                                <Label text="Detail Foto:" />
                                <Region HBox.hgrow="ALWAYS" />
                                <Button fx:id="deleteReportButton" text="Hapus Laporan" onAction="#handleDeleteReport" style="-fx-background-color: #ffebee; -fx-text-fill: #c62828;" disable="true"/>
                            </HBox>
                            <ImageView fx:id="historyImageView" fitHeight="150.0" fitWidth="200.0" pickOnBounds="true" preserveRatio="true" />
                            <Label text="Tanggapan Admin:" />
                            <TextArea fx:id="responseArea" editable="false" prefHeight="60.0" wrapText="true" />
                            
                            <Separator />
                            <Label text="Diskusi / Chat:" style="-fx-font-weight: bold;"/>
                            <ListView fx:id="chatListView" VBox.vgrow="ALWAYS" prefHeight="150.0"/>
                            <HBox spacing="10.0">
                                <TextField fx:id="chatInputField" promptText="Tulis pesan..." HBox.hgrow="ALWAYS"/>
                                <Button text="Kirim" onAction="#handleSendChat"/>
                            </HBox>
                        </VBox>
                    </content>
                </Tab>
                <Tab fx:id="profileTab" text="Edit Profil">
                    <content>
                        <ScrollPane fitToWidth="true">
                            <content>
                                <VBox spacing="10.0">
                                    <padding>
                                        <Insets bottom="20.0" left="20.0" right="20.0" top="20.0" />
                                    </padding>
                                    <HBox alignment="CENTER_LEFT" spacing="20.0">
                                        <ImageView fx:id="profileImageView" fitHeight="100.0" fitWidth="100.0" pickOnBounds="true" preserveRatio="true" />
                                        <Button onAction="#handleChooseProfilePhoto" text="Ganti Foto Profil" />
                                    </HBox>
                                    
                                    <Label text="Informasi Akun">
                                        <font>
                                            <Font name="System Bold" size="16.0" />
                                        </font>
                                    </Label>
                                    <Label text="NIK" />
                                    <TextField fx:id="editNikField" editable="false" style="-fx-background-color: #e0e0e0;" />
                                    <Label text="Username" />
                                    <TextField fx:id="editUsernameField" editable="false" style="-fx-background-color: #e0e0e0;" />
                                    
                                    <Label text="Data Diri">
                                        <font>
                                            <Font name="System Bold" size="16.0" />
                                        </font>
                                    </Label>
                                    <Label text="Nama Lengkap" />
                                    <TextField fx:id="editNameField" />
                                    <Label text="Nomor Telepon" />
                                    <TextField fx:id="editPhoneField" />
                                    <Label text="Alamat" />
                                    <TextArea fx:id="editAddressField" prefHeight="80.0" />
                                    <Button onAction="#handleUpdateProfile" text="Simpan Data Diri" />
                                    
                                    <Separator />
                                    
                                    <Label text="Ganti Password">
                                        <font>
                                            <Font name="System Bold" size="16.0" />
                                        </font>
                                    </Label>
                                    <Label text="Password Lama" />
                                    <PasswordField fx:id="oldPasswordField" />
                                    <Label text="Password Baru" />
                                    <PasswordField fx:id="newPasswordField" />
                                    <Label text="Konfirmasi Password Baru" />
                                    <PasswordField fx:id="confirmPasswordField" />
                                    <Button onAction="#handleChangePassword" text="Ubah Password" />
                                </VBox>
                            </content>
                        </ScrollPane>
                    </content>
                </Tab>
            </tabs>
        </TabPane>
    </center>
</BorderPane>
